name: Publish

on: workflow_dispatch
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 6.0.x
        include-prerelease: true

    #TODO: find a better way to do this
    - name: Publish Win-x64
      run: dotnet publish src/AnvilPacker -c Release -p:IsPublish=true -p:CommitHash=${GITHUB_SHA::8} -r win-x64 -o dist/win-x64 
      
    - name: Publish Linux-x64
      run: dotnet publish src/AnvilPacker -c Release -p:IsPublish=true -p:CommitHash=${GITHUB_SHA::8} -r linux-x64 -o dist/linux-x64 
      
    - name: Publish OSX-x64
      run: dotnet publish src/AnvilPacker -c Release -p:IsPublish=true -p:CommitHash=${GITHUB_SHA::8} -r osx-x64 -o dist/osx-x64 
      
    
    - name: Upload Win-x64 Artifacts
      uses: actions/upload-artifact@v2.2.4
      with:
        name: AnvilPacker (Windows, x64)
        path: dist/win-x64
    
    - name: Upload Linux-x64 Artifacts
      uses: actions/upload-artifact@v2.2.4
      with:
        name: AnvilPacker (Linux, x64)
        path: dist/linux-x64
        
    - name: Upload OSX-x64 Artifacts
      uses: actions/upload-artifact@v2.2.4
      with:
        name: AnvilPacker (macOS, x64)
        path: dist/osx-x64
        
        